# ğŸ“„ åœ°åœ–å³æ™‚åœ–ç‰‡åˆ†äº« App - å¾Œç«¯éœ€æ±‚æ›¸

ç‰ˆæœ¬ï¼š1.1  
æ’°å¯«æ—¥æœŸï¼š2025/12  
å¾Œç«¯å¹³å°ï¼šNode.js + Express  
è³‡æ–™åº«ï¼šSupabase (PostgreSQL) + Realtime + Auth  
åœ–ç‰‡å„²å­˜ï¼šCloudflare R2

---

## 1. ç³»çµ±æ¦‚è¿°

å¾Œç«¯è² è²¬ï¼š

- ç®¡ç†ä½¿ç”¨è€…èªè­‰èˆ‡æˆæ¬Šï¼ˆSupabase Authï¼‰
- è™•ç† API è«‹æ±‚ï¼ˆNode.js + Expressï¼‰
- èˆ‡ Supabase DB äº’å‹•ï¼Œå­˜å–æ¨™é»ã€åœ–ç‰‡ã€ç•™è¨€ã€æ„›å¿ƒ metadata
- èˆ‡ Cloudflare R2 äº’å‹•ï¼Œå­˜å–åŸåœ–èˆ‡ç¸®åœ–
- ç”Ÿæˆ Signed URL çµ¦ App å®‰å…¨ä¸‹è¼‰åœ–ç‰‡
- æä¾›å³æ™‚è³‡æ–™æ›´æ–°ï¼ˆSupabase Realtimeï¼‰

---

## 2. å¾Œç«¯åŠŸèƒ½éœ€æ±‚

### 2.1 ä½¿ç”¨è€…ç®¡ç†

- ä½¿ç”¨ Supabase Auth ç®¡ç†å¸³è™Ÿè¨»å†Šã€ç™»å…¥ã€ç™»å‡º
- é©—è­‰ä½¿ç”¨è€… session èˆ‡æ¬Šé™
- æ‰€æœ‰ API å¿…é ˆ HTTPS

### 2.2 æ¨™é»ï¼ˆPointsï¼‰

- æ–°å¢æ¨™é»ï¼ˆå«æ¨™é¡Œã€æè¿°ã€ç¶“ç·¯åº¦ï¼‰
- æŸ¥è©¢æ¨™é»åˆ—è¡¨ï¼ˆå¯æ”¯æ´åœ°åœ–ç¯„åœç¯©é¸ï¼‰
- å›å‚³æ¨™é»è©³ç´°è³‡æ–™ï¼ˆå«ç¸®ç•¥åœ–ã€åœ–ç‰‡ metadataã€ç•™è¨€æ•¸ã€æ„›å¿ƒæ•¸ï¼‰

### 2.3 åœ–ç‰‡ç®¡ç†ï¼ˆImagesï¼‰

- æ¥æ”¶ App ä¸Šå‚³çš„åœ–ç‰‡æª”æ¡ˆ
- ä¸Šå‚³è‡³ Cloudflare R2ï¼ˆåŸåœ– + ç¸®åœ–ï¼‰
- å–å¾— R2 URLï¼Œå¯«å…¥ Supabase `images` table
- æ”¯æ´å®Œæ•´åœ°é»è³‡è¨Šï¼š
  - latitude, longitude
  - country, administrative_area, locality, sub_locality, thoroughfare, sub_thoroughfare
- ç”Ÿæˆ Signed URLï¼ˆé™æ™‚æœ‰æ•ˆï¼‰æä¾› App å®‰å…¨å­˜å–

### 2.4 æ„›å¿ƒåŠŸèƒ½ï¼ˆLikesï¼‰

- APIï¼š
  - `POST /points/:pointId/like` â†’ é»æ„›å¿ƒ
  - `POST /points/:pointId/unlike` â†’ å–æ¶ˆæ„›å¿ƒ
- ç¢ºä¿æ¯å€‹ä½¿ç”¨è€…å°æ¯å€‹æ¨™é»åªèƒ½æŒ‰ä¸€æ¬¡
- æ›´æ–° DB æ„›å¿ƒæ•¸é‡ï¼Œæ”¯æ´å¿«å–

### 2.5 ç•™è¨€åŠŸèƒ½ï¼ˆCommentsï¼‰

- APIï¼š
  - `POST /points/:pointId/comments` â†’ æ–°å¢ç•™è¨€
  - `GET /points/:pointId/comments` â†’ å–å¾—ç•™è¨€åˆ—è¡¨
- æ¯å‰‡ç•™è¨€å¯æŒ‰æ„›å¿ƒ
- å³æ™‚åŒæ­¥ç•™è¨€èˆ‡æ„›å¿ƒæ•¸é‡ï¼ˆSupabase Realtimeï¼‰
- æš«æ™‚ä¸æ”¯æ´å›è¦†åŠŸèƒ½

---

## 3. è³‡æ–™åº«è¨­è¨ˆï¼ˆSupabaseï¼‰

### 3.1 points

| æ¬„ä½        | å‹åˆ¥      | èªªæ˜     |
| ----------- | --------- | -------- |
| id          | uuid      | ä¸»éµ     |
| user_id     | uuid      | å»ºç«‹è€…   |
| title       | text      | æ¨™é¡Œ     |
| description | text      | æè¿°     |
| lat         | double    | ç·¯åº¦     |
| lng         | double    | ç¶“åº¦     |
| created_at  | timestamp | å»ºç«‹æ™‚é–“ |

### 3.2 images

| æ¬„ä½                | å‹åˆ¥      | èªªæ˜            |
| ------------------- | --------- | --------------- |
| id                  | uuid      | ä¸»éµ            |
| point_id            | uuid      | æ‰€å±¬æ¨™é»        |
| uploader_id         | uuid      | ä¸Šå‚³è€…          |
| image_url           | text      | åŸåœ– URL        |
| thumbnail_url       | text      | ç¸®åœ– URL        |
| taken_at            | timestamp | æ‹æ”æ™‚é–“        |
| latitude            | double    | ç·¯åº¦            |
| longitude           | double    | ç¶“åº¦            |
| country             | text      | åœ‹å®¶            |
| administrative_area | text      | çœ/å·           |
| locality            | text      | å¸‚/å€           |
| sub_locality        | text      | è¡—é“ / æ¬¡ç´šå€åŸŸ |
| thoroughfare        | text      | è¡—é“åç¨±        |
| sub_thoroughfare    | text      | è¡—é“è™Ÿ          |
| created_at          | timestamp | ä¸Šå‚³æ™‚é–“        |

### 3.3 point_likes

| æ¬„ä½                      | å‹åˆ¥      | èªªæ˜               |
| ------------------------- | --------- | ------------------ |
| id                        | uuid      | ä¸»éµ               |
| point_id                  | uuid      | å°æ‡‰æ¨™é»           |
| user_id                   | uuid      | ä½¿ç”¨è€…             |
| created_at                | timestamp | æ™‚é–“               |
| UNIQUE(point_id, user_id) | -         | æ¯äººæ¯é»åªèƒ½æŒ‰ä¸€æ¬¡ |

### 3.4 point_comments

| æ¬„ä½        | å‹åˆ¥      | èªªæ˜         |
| ----------- | --------- | ------------ |
| id          | uuid      | ä¸»éµ         |
| point_id    | uuid      | æ‰€å±¬æ¨™é»     |
| user_id     | uuid      | ç•™è¨€è€…       |
| content     | text      | å…§å®¹         |
| likes_count | int       | å¿«å–æ„›å¿ƒæ•¸é‡ |
| created_at  | timestamp | ç•™è¨€æ™‚é–“     |

---

## 4. API ä»‹é¢ï¼ˆNode.js / Expressï¼‰

| åŠŸèƒ½             | Method | Endpoint                  | Body / Query                                                                                                                                                          |
| ---------------- | ------ | ------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| æ–°å¢æ¨™é»         | POST   | /points                   | { title, description, lat, lng, user_id }                                                                                                                             |
| æŸ¥è©¢æ¨™é»åˆ—è¡¨     | GET    | /points                   | ?lat_min=&lat_max=&lng_min=&lng_max=                                                                                                                                  |
| å–å¾—æ¨™é»è©³ç´°è³‡æ–™ | GET    | /points/:pointId          | -                                                                                                                                                                     |
| ä¸Šå‚³åœ–ç‰‡         | POST   | /points/:pointId/images   | multipart/form-data: { image_file, uploader_id, taken_at, latitude, longitude, country, administrative_area, locality, sub_locality, thoroughfare, sub_thoroughfare } |
| å–å¾—æ¨™é»åœ–ç‰‡     | GET    | /points/:pointId/images   | -                                                                                                                                                                     |
| ç•™è¨€             | POST   | /points/:pointId/comments | { user_id, content }                                                                                                                                                  |
| å–å¾—ç•™è¨€åˆ—è¡¨     | GET    | /points/:pointId/comments | -                                                                                                                                                                     |
| æ„›å¿ƒ             | POST   | /points/:pointId/like     | { user_id }                                                                                                                                                           |
| å–æ¶ˆæ„›å¿ƒ         | POST   | /points/:pointId/unlike   | { user_id }                                                                                                                                                           |

---

## 5. åœ–ç‰‡è™•ç†æµç¨‹

1. App ä¸Šå‚³åœ–ç‰‡æª”æ¡ˆåˆ°å¾Œç«¯
2. å¾Œç«¯å£“ç¸®åŸåœ–ã€ç”Ÿæˆç¸®åœ–
3. ä¸Šå‚³è‡³ Cloudflare R2
4. å–å¾— R2 URL / Signed URL
5. å„²å­˜åœ–ç‰‡ metadata è‡³ `images` table
6. å›å‚³ URL çµ¦ App é¡¯ç¤ºç¸®åœ– / åŸåœ–

---

## 6. å®‰å…¨æ€§

- æ‰€æœ‰ API ä½¿ç”¨ HTTPS
- ä½¿ç”¨ Supabase Auth é©—è­‰ä½¿ç”¨è€…èº«ä»½
- ä½¿ç”¨è€…åªèƒ½ä¿®æ”¹è‡ªå·±è³‡æ–™ï¼ˆRLS Policyï¼‰
- åœ–ç‰‡å…¬é–‹å­˜å–å¯ç”¨ Signed URL æ§åˆ¶æœ‰æ•ˆæœŸé™

---

## 7. å³æ™‚æ›´æ–°

- ä½¿ç”¨ Supabase Realtime
- æ–°å¢åœ–ç‰‡ / ç•™è¨€ / æ„›å¿ƒæ™‚ï¼Œæ¨é€å³æ™‚æ›´æ–°åˆ° App

---

## 8. æˆæœ¬èˆ‡é™åˆ¶

- Supabase Free Tierï¼š
  - æ¯æ—¥ 50 è¬ DB æ“ä½œ
  - DB å®¹é‡ 500MB
- Cloudflare R2ï¼š
  - å…è²» 10GB å„²å­˜ï¼ˆåŸåœ– + ç¸®åœ–ï¼‰
  - è¶…é $0.015 / GB / æœˆ

---

## 9. å¾Œç«¯éƒ¨ç½²å»ºè­°

- Node.js + Express
- ä½¿ç”¨ Vercel / Railway / Render / Heroku éƒ¨ç½² API
- App èˆ‡å¾Œç«¯åˆ†é–‹éƒ¨ç½²ï¼Œé€é HTTPS API æºé€š
- å¾Œç«¯å¯ç”Ÿæˆ Signed URLï¼Œé¿å…å‰ç«¯ç›´æ¥å­˜å– R2 åŸåœ–é€ æˆå®‰å…¨å•é¡Œ

---
